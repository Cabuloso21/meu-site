<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
 
<style>
 body {
 font-family: Arial, sans-serif;
 background-color: #f4f4f4;
 margin: 0;
      
 }

 .arrow {
 display: inline-block;
 width: 10px;
 height: 10px;
 border-top: 2px solid black;
 border-right: 2px solid black;
 transform: rotate(-130deg);
 position: absolute;
 top: 21px;
 left: 15px;

 }

 header {
 background: goldenrod;
 Padding: 15px;

 }

.logo {
 margin: 0;
 margin-top: 0px;
 font-size: 22px;
 font-weight: bold;
 color: white;
 text-align: center;
    
 }

 #addCategory {
 background-color: goldenrod;
 color: black;
 padding: 12px 20px;
 border: none;
 border-radius: 10px;
 cursor: pointer;
 margin-left: 15px;
 margin-top: 20px;
 margin-bottom: 40px;
 font-size: 15px;
 font-weight: bold;
      
 }

 #addCategory:hover {
 background-color: orange;
        
 }

 #searchCategory {
 padding: 12px;
 margin-left: 10px;
 border: 1px solid #ccc;
 border-radius: 4px;
 background: white;
 outline: none;
 }

 span {
 font-size: 15px;
 text-align: center;
 color: black;
 margin-top: 20px;
 margin-left: 20px;
 
 }

 #categoriesContainer > div {
 border: 1px solid silver;
 border-radius: 4px;
 position: center;
 background: white;
 margin-bottom: 22px;
 box-shadow: 0 0px 0px rgba(0, 0, 0, 0.2);
 margin-left: 5px;   
 width: 96.80%; /* Ocupa 100% da largura disponível */
 margin-top: 20px;
 height: 890px;
 }

 #categoriesContainer > div h3 {
 font-size: 22px;
 margin-left: 10px;
 margin-right: 10px;
 margin-top: 15px;
 margin-bottom: 10px;
 color:  #13294b;
 border-bottom: 1px solid none;
 outline: none;
 
 }

 input[type="number"] {
 width: 40%;
 margin-top: 10px;
 padding: 10px;
 border: 1px solid #ccc;
 border-radius: 4px;
 margin-bottom: 35px;
 margin-left: 10px;
 outline: none;

 }

 label {
 margin-left: 10px;
 color: black;
 font-size: 15.50px;
 font-weight: bold;
  
 }

 #categoriesContainer> div input[type="name"] {
 Padding: 10px;
 width: 320px;
 margin-left: 5px;
 border: none;
 border-radius: none;
 font-size: 15.50px;
 border-bottom: 1.50px solid #ccc;
 margin-bottom: 30px;
 color: black;
 outline: none;
 
 } 

 button {
 background-color: white;
 color: #4CAF50;
 border: 1px solid #ccc;
 padding: 5px 10px;
 margin-left: 169px;
 cursor: pointer;
 border-radius: 10px;
 font-weight: bold;

 }

 button:hover {
 background-color: white;
    
 }

 
 .delete-button {
 color: #4CAF50;
 cursor: pointer;
 font-size: 14px;
 font-weight: bold;
 margin-left: 13px;
 background: white;   
 border: 1px solid #ccc;
 border-radius: 10px;
 padding: 5px 10px;

 }

 .delete-button:hover {
 text-decoration: none;
      
 }

 .modal {
 display: none;
 position: fixed;
 top: 40%;
 left: 50%;
 transform: translate(-50%, -50%);
 background-color: white;
 padding: 25px;
 border: 1px solid #ccc;
 border-radius: 5px;
 box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
 z-index: 1000;
    
 }

 input[type="text"] {
 width: 220px;
 padding: 10px;
 margin-top: 5px;
 border-radius: 10px;
 border-color: #cc1;
 font-size: 16px;
 border: 1px solid #ccc;
 margin-left: 0px;
 outline: none;

 }

 butão {
 background-color: white;
 color: #13294b;
 border: none;
 font-weight: bold;
 padding: 4px 10px;
 margin: 0px;
 margin-left: 0px;
 cursor: pointer;
 border-radius: 5px;
 font-size: 14px;
 
 }

 .modal .modal-butão {
 display: flex;
 justify-content: space-between;
 margin-top: 10px;
    
 }

 .delete-modal-buttons {
 display: flex;
 justify-content: space-between;
 margin-top: 20px;
    
 }
  
 .alert {
 display: none;
 position: fixed;
 top: 130px;
 left: 60%;
 transform: translateX(-50%);
 background-color: #f44336;
 color: white;
 padding: 10px;
 border-radius: 5px;
 z-index: 1000;
    
 }
        
 footer {
 background-color: #555;
 padding: 1px;
 margin-top: 20%;
 border-bottom: 1px solid white; 
        
 }
  
 .brand p {
 font-size: 14px;
 color: silver;
 text-align: absolute;
 margin-left: 17px;
                        
 }        

 </style>
 </head>
 <body>
 <a href="admi.html">
 <div class="arrow"></div>
 </a>
 </div>
  
 <header>
 <div class="logo">Revisitas</div>
 </header>

 <button id="addCategory">Adicionar</button>
 <input type="name" id="searchCategory" placeholder="Pesquisar revisita" oninput="searchCategories()">

 <div id="categoryCount">
 <span id="totalCategories">0</span>
 </div>

 
 <div id="categoriesContainer">
 <p id="emptyMessage">Não há nada aqui</p>
 </div>

 <div class="alert" id="whatsappAlert"></div>
 <div class="alert" id="customAlert">Você não tem nenhuma revisita com esse nome.</div>

 <div class="modal" id="addCategoryModal">
 <input type="text" id="categoryNameInput" placeholder="Nome da pessoa">
 <div class="modal-butão">
 <butão onclick="closeCategoryModal()">Cancelar</butão>
 <butão onclick="confirmAddCategory()">Adicionar</butão>
 </div>
 </div>

 <div class="modal" id="deleteCategoryModal">
 <p>Deseja excluir esse estudante?</p>
 <div class="delete-modal-buttons">
 <butão onclick="closeDeleteCategoryModal()">Não</butão>
 <butão onclick="confirmDelete()">Sim</butão>
 </div>
 </div>




<script>

function generateUniqueId() {
    return 'category_' + Math.random().toString(36).substr(2, 9);
}

function pageKey() {
    return 'pagina2';
}

const storageKey = `categories_${pageKey()}`;

const addButton = document.getElementById('addCategory');
const searchInput = document.getElementById('searchCategory');
const categoriesContainer = document.getElementById('categoriesContainer');
const emptyMessage = document.getElementById('emptyMessage');
const customAlert = document.getElementById('customAlert');
const addCategoryModal = document.getElementById('addCategoryModal');
const categoryNameInput = document.getElementById('categoryNameInput');
const deleteCategoryModal = document.getElementById('deleteCategoryModal');

let categoryToDelete = null;

window.addEventListener('load', loadCategories);

addButton.addEventListener('click', showCategoryModal);

function loadCategories() {
    const savedCategories = JSON.parse(localStorage.getItem(storageKey)) || [];
    categoriesContainer.innerHTML = '';
    savedCategories.forEach((categoryData) => {
        createCategory(categoryData);
    });
    checkEmptyCategories();
    countCategories();
}

function showCategoryModal() {
    addCategoryModal.style.display = 'block';
    categoryNameInput.focus();
}

function closeCategoryModal() {
    addCategoryModal.style.display = 'none';
}

function confirmAddCategory() {
    const categoryName = categoryNameInput.value.trim();
    if (categoryName) {
        const categoryData = {
            id: generateUniqueId(),
            name: categoryName,
            conversa: "",
            texto: "",
            publicação: "",
            proxima: "",
            assunto: "",
            dia: "",
            hora: "",
            endereço: "",
            numero: "",
        };

        createCategory(categoryData);
        saveCategories();
        closeCategoryModal();
        categoryNameInput.value = '';
        countCategories();
    }
}

function preventOverflow(element) {
    element.style.whiteSpace = "nowrap";
    element.style.overflow = "hidden";
    element.style.textOverflow = "ellipsis";
}

function preventLineBreak(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
    }
}

function createCategory(categoryData) {
    if (emptyMessage) {
        emptyMessage.style.display = 'none';
    }

    const categoryDiv = document.createElement('div');
    categoryDiv.id = categoryData.id;
    categoryDiv.className = 'category';
    categoryDiv.innerHTML = `
        <h3 contenteditable="true" oninput="saveCategories()" onkeydown="preventLineBreak(event)">${categoryData.name}</h3>
        <input type="number" class="phoneNumber" placeholder="Número do WhatsApp" value="${categoryData.phoneNumber || ''}" oninput="saveCategories()">
        <div>
            <label for="conversa">Primeira conversa:</label>
            <input type="name" class="conversa" value="${categoryData.conversa}" oninput="saveCategories()">
        </div>
        <div>
            <label for="texto">Texto da biblia:</label>
            <input type="name" class="texto" value="${categoryData.texto}" oninput="saveCategories()">
        </div>
        <div>
            <label for="publicação">Publicação:</label>
            <input type="name" class="publicação" value="${categoryData.publicação}" oninput="saveCategories()">
        </div>
        <div>
            <label for="proxima">Segunda conversa:</label>
            <input type="name" class="proxima" value="${categoryData.proxima}" oninput="saveCategories()">
        </div>
        <div>
            
            <label for="assunto">Assunto:</label>
            <input type="name" class="assunto" value="${categoryData.assunto}" oninput="saveCategories()">
        </div>
        <div>
            
           <label for="dia">Dia:</label>
           <input type="name" class="dia" value="${categoryData.dia}" oninput="saveCategories()">
        </div>
        <div>
           
           <label for="hora">Horário:</label>
           <input type="name" class="hora" value="${categoryData.hora}" oninput="formatHora(this)">
        </div>
        <div>
  
          <label for="endereço">Endereço:</label>
          <input type="name" class="endereço" value="${categoryData.endereço}" oninput="saveCategories()">
        </div>
        <div>
       <label for="numero">Numero da casa:</label>
         <input type="name" class="numero" value="${categoryData.numero}" oninput="saveCategories()">
        </div>
     <span class="delete-button" onclick="confirmDeleteCategory('${categoryData.id}')">Excluir</span>
    <button onclick="redirectToWhatsApp(this)">Conversar</button>
    `;

    categoriesContainer.appendChild(categoryDiv);

    // Aplicar as restrições de overflow no h3
    const h3Element = categoryDiv.querySelector('h3');
    preventOverflow(h3Element);
}

function confirmDeleteCategory(categoryId) {
    categoryToDelete = categoryId;
    deleteCategoryModal.style.display = 'block';
}

function closeDeleteCategoryModal() {
    deleteCategoryModal.style.display = 'none';
    categoryToDelete = null;
}

function confirmDelete() {
    if (categoryToDelete) {
        const categoryDiv = document.getElementById(categoryToDelete);
        if (categoryDiv) {
            categoryDiv.remove();
            saveCategories();
            checkEmptyCategories();
            countCategories();
        }
    }
    closeDeleteCategoryModal();
}

function saveCategories() {
    const categories = Array.from(categoriesContainer.children);
    const categoriesData = categories.map((category) => ({
        id: category.id,
        name: category.querySelector('h3').textContent,
        phoneNumber: category.querySelector('.phoneNumber').value || "",
        conversa: category.querySelector('.conversa').value || "",
        texto: category.querySelector('.texto').value || "",
        publicação: category.querySelector('.publicação').value || "",
        proxima: category.querySelector('.proxima').value || "",
        assunto: category.querySelector('.assunto').value || "",
        dia: category.querySelector('.dia').value || "",
        hora: category.querySelector('.hora').value || "",
        endereço: category.querySelector('.endereço').value || "",
        numero: category.querySelector('.numero').value || "",
      
    }));

    localStorage.setItem(storageKey, JSON.stringify(categoriesData));
    checkEmptyCategories();
    countCategories();
}

function checkEmptyCategories() {
    const categories = categoriesContainer.children;
    if (categories.length === 0) {
        emptyMessage.style.display = 'block';
    } else {
        emptyMessage.style.display = 'none';
    }
}

function countCategories() {
    const totalCategories = categoriesContainer.children.length;
    document.getElementById('totalCategories').textContent = `Total de revisitas: ${totalCategories}`;
}

function redirectToWhatsApp(button) {
    const categoryDiv = button.parentElement;
    const categoryId = categoryDiv.id;
    const savedCategories = JSON.parse(localStorage.getItem(storageKey)) || [];
    const categoryData = savedCategories.find(category => category.id === categoryId);

    if (categoryData) {
        const phoneNumber = categoryData.phoneNumber;
        if (phoneNumber) {
            window.location.href = `https://api.whatsapp.com/send?phone=${phoneNumber}`;
        } else {
            showAlert("Por favor. adicione o Whatsapp da revisita!");
        }
    }
}

function showAlert(message) {
    const whatsappAlert = document.getElementById('whatsappAlert');
    whatsappAlert.textContent = message;
    whatsappAlert.style.display = 'block';
    setTimeout(() => {
        whatsappAlert.style.display = 'none';
    }, 3000);
}

function searchCategories() {
    const searchTerm = searchInput.value.toLowerCase();
    const categories = categoriesContainer.children;
    let found = false;

    for (let i = 0; i < categories.length; i++) {
        const category = categories[i];
        const categoryName = category.querySelector('h3').textContent.toLowerCase();

        if (categoryName.includes(searchTerm)) {
            category.style.display = 'block';
            found = true;
        } else {
            category.style.display = 'none';
        }
    }

    if (!found) {
        customAlert.style.display = 'block';
    } else {
        customAlert.style.display = 'none';
    }
}

function formatHora(input) {
    const hora = input.value;
    if (hora.length === 2 && hora.indexOf(':') === -1) {
        input.value = hora + ':00';
    }
    saveCategories();
}

</script>



